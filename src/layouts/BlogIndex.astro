---
import BaseLayout from './BaseLayout.astro'
import Navigation from '../components/navigation/navigation'

// Page front-matter from index.mdx
const {
  title = 'Writing | Sinisa Mikulic',
  description = 'Writing on React, performance, UX, and shipping fast.',
} = Astro.props

// Collect all posts under /pages/blog EXCEPT index.mdx
const modules = import.meta.glob('../pages/blog/**/!(*index).mdx', { eager: true })
const posts = Object.values(modules)
  .map((module: any) => {
    return {
    url: module.url,                 // final route, e.g. /blog/hello-world/
    ...module.frontmatter,           // title, description, date, tags, hero, draft?
  }})
  .filter((p) => !p.draft)
  .sort((a, b) => +new Date(b.date) - +new Date(a.date))

const fmt = (d: any) =>
  new Date(d).toLocaleDateString('en-GB', { year:'numeric', month:'short', day:'2-digit' })

// Prefix with BASE_URL so GitHub Pages project paths work
const base = import.meta.env.BASE_URL || '/'
const href = (u: any) => `${base}${String(u).replace(/^\//, '')}`
---

<BaseLayout title={title} description={description}>
  <main class="container">
    <Navigation />

    <div class="section section-intro">
    <h1>Writing</h1>

    {posts.length === 0 ? (
      <p>No posts yet.</p>
    ) : (
      <ul style="list-style:none;padding:0;margin:1.5rem 0;">
        {posts.map((p) => (
          <li style="margin:1.25rem 0;border-bottom:1px solid #eee;padding-bottom:1rem;">
            <h2 style="margin:0 0 .25rem 0;font-size:1.25rem;">
              <a href={href(p.url)} style="color: salmon">{p.title}</a>
            </h2>
            <small style="color:#666;">{fmt(p.date)}</small>
            <p style="margin:.5rem 0 0 0;">{p.description}</p>
          </li>
        ))}
      </ul>
    )}

    <!-- JSON-LD -->
    <script type="application/ld+json" is:inline>
      {JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'Blog',
        name: 'Sinisa Mikulic â€” Writing',
        url: new URL('/blog/', Astro.url).toString()
      })}
    </script>
    </div>
  </main>
</BaseLayout>
